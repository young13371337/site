<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>young1337</title>
  <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#121212;--panel:#181b24;--panel2:#23272e;--ink:#eee;--muted:#aaa;--line:#292c36;
      --brand:#3fa7ff;--ok:#3fcf7f;--err:#e74c3c;--warn:#c2a176;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;background:var(--bg);color:var(--ink)}
    header{
  position:fixed;inset:0 0 auto 0;height:54px;background:rgba(18,18,18,.9);
  display:flex;align-items:center;gap:16px;padding:0 18px;z-index:1000;box-shadow:0 2px 8px rgba(0,0,0,.7);
  overflow:visible;
    }
    .logo{
  font-family:'Rock Salt',cursive;
  font-size:3.2rem;
  margin-top:2px;
  color:#fff;
  user-select:none;
  text-shadow:1px 1px 0 #000, 2px 2px 3px rgba(0,0,0,.6);
  margin-right:12px;
  line-height:1.1;
  position:relative;
  top:2px;
    }
    .header-nav{display:flex;align-items:center;gap:18px}
    .app-button{
      font:700 1.1rem 'Segoe UI',Roboto,sans-serif;
      color:#fff;
      background:transparent;
      border:none;
      padding:0 16px;
      border-radius:10px;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      height:36px;
      min-width: 0;
      transition:all .25s cubic-bezier(.4,2,.3,1);
      position:relative;
      overflow:visible;
      line-height:1.1;
      text-shadow:0 2px 12px rgba(80,180,255,.18), 0 0 2px #222;
      margin-top:0;
      margin-bottom:0;
      z-index:2;
    }
    .app-button:hover{
      background:rgba(255,255,255,.12);
      border:2px solid rgba(255,255,255,.22);
      box-shadow:0 4px 24px rgba(80,180,255,.18), 0 0 0 2px rgba(80,180,255,.12) inset;
      backdrop-filter:blur(12px) saturate(140%) brightness(1.12) contrast(1.08);
    }
    .app-button::after {
      content:"";
      position:absolute;
      left:0;top:0;right:0;bottom:0;
      pointer-events:none;
      opacity:0;
      transition:opacity .3s;
      background:radial-gradient(circle at 60% 40%,rgba(255,255,255,.18) 0%,rgba(255,255,255,0) 70%);
      z-index:1;
    }
    .app-button:hover::after {
      opacity:.8;
    }
    .app-button.disabled{color:#888;cursor:default}
    main{padding-top:80px;text-align:center}
    .hidden{display:none !important}

    /* --- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ (—Å–µ—Ä—ã–π –¥–∏–∑–∞–π–Ω) --- */
    .modal{display:none;position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.7);justify-content:center;align-items:center}
    .modal-content-gray{
      background:var(--panel2);border-radius:14px;padding:28px 24px;min-width:340px;max-width:500px;color:var(--ink);text-align:center;position:relative
    }
    .close-btn{position:absolute;right:12px;top:10px;font-size:1.6rem;color:#aaa;background:none;border:none;cursor:pointer}
    .close-btn:hover{color:#fff}
    .input-gray{
      width:100%;margin-bottom:12px;padding:12px;border-radius:9px;border:1.5px solid #444;background:#2e323a;color:#fff;outline:none
    }
    .input-gray:focus{border-color:#666;background:#353942}
    .modal-main-btn{
      width:100%;background:transparent;color:#fff;border-radius:8px;margin-top:8px;font-size:1.05rem;font-weight:600;padding:12px 0;border:none
    }
    .modal-main-btn:hover{background:rgba(128,128,128,.2)}

    /* --- –ü—Ä–æ—Ñ–∏–ª—å --- */
    .profile-avatar{width:84px;height:84px;border-radius:50%;object-fit:cover;background:#1e1e1e;border:2px solid var(--brand);display:block;margin:6px auto 10px}
    .center-btn { display: flex; justify-content: center; margin-bottom: 8px; }
    .edit-nick-btn {
      background:transparent;
      border:none;
      color:var(--brand);
      font-size:1.2em;
      cursor:pointer;
      margin-left:6px;
      vertical-align:middle;
      transition:color .2s;
    }
    .edit-nick-btn:hover { color:#fff; }
    .hashtag-input {
      max-width:60px;
      margin-right:8px;
      text-align:center;
      font-weight:700;
      font-size:1.05em;
      border-radius:8px;
      border:1px solid #444;
      background:#23272e;
      color:#3fa7ff;
      padding:8px 6px;
    }
    .profile-pass-row {
      display: flex;
      gap: 0;
      margin-bottom: 8px;
    }
    #newPasswordInput {
      flex: 1;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      margin-bottom: 0;
      border-right: none;
    }
    #changePasswordBtn {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
      margin-bottom: 0;
      height: 48px;
      font-size: 1.08em;
      padding: 0 18px;
      min-width: 120px;
    }

    /* --- –ß–∞—Ç-–ø–∞–Ω–µ–ª—å --- */
    #chatPanel{display:none;position:fixed;inset:0;z-index:1500;background:rgba(0,0,0,.45);align-items:flex-start;justify-content:center}
    .chat-window{
      display:flex;gap:0;background:#222;border-radius:12px;max-width:1100px;width:95vw;height:80vh;margin-top:64px;overflow:hidden;position:relative;box-shadow:0 4px 32px rgba(0,0,0,.7)
    }
    .chat-left{
      width:280px;min-width:220px;max-height:100%;overflow-y:auto;background:var(--panel);border-right:1px solid var(--line);display:flex;flex-direction:column
    }
    .chat-left-header{padding:16px 16px 8px 16px;font-weight:700;color:#ddd}
    .chat-add-btn{
      margin:0 12px 12px 12px;display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:8px;background:var(--panel2);color:#fff;cursor:pointer;font-weight:700;justify-content:center;border:1px solid transparent
    }
    .chat-add-btn:hover{border-color:#445}
    .chat-list{display:flex;flex-direction:column;padding:4px 8px 12px 8px;gap:6px}
    .chat-item{
      display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;background:transparent;color:#ddd;cursor:pointer;border:1px solid transparent
    }
    .chat-item:hover{background:#212630;border-color:#2a3344}
    .chat-item.selected{background:#23272e;border-color:#334;box-shadow:inset 0 0 0 1px #334}
    .chat-item-avatar{width:38px;height:38px;border-radius:50%;object-fit:cover;background:#1e1e1e;border:1px solid #333}
    .chat-item-txt{display:flex;flex-direction:column;min-width:0}
    .chat-item-nick{color:var(--brand);font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .chat-item-last{color:#aaa;font-size:.92em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .chat-main{flex:1;display:flex;flex-direction:column;min-width:0}
    .chat-header{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px;background:#1c1f27}
    .chat-peer-avatar{width:40px;height:40px;border-radius:50%;border:1px solid #333;object-fit:cover}
    .chat-peer-avatar.empty { display:none; }
    .chat-peer-name{font-weight:800;color:#fff}
    .chat-msgs{flex:1;overflow-y:auto;padding:10px;background:transparent}
    .msg-row{display:flex;align-items:flex-start;gap:10px;padding:6px 8px;border-bottom:1px solid #333}
    .msg-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;background:#1e1e1e;border:1px solid #333}
    .msg-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .msg-nick{color:var(--brand);font-weight:800}
    .chat-role-badge{font-size:.83em;background:#333950;color:#5cb7ff;border-radius:8px;padding:1px 9px;font-weight:700}
    .chat-role-admin{background:#2d1e36;color:#ff7d7d}.chat-role-moder{background:#2d2a1e;color:#ffe27d}.chat-role-user{background:#22332d;color:#3fcf7f}.chat-role-govnar{background:#3b2414;color:#c2a176}
    .msg-time{color:#888;font-size:.9em}
    .msg-text{color:#fff;margin-top:3px;white-space:pre-wrap;word-break:break-word}
    .msg-actions{margin-left:auto;display:flex;gap:4px}
    .icon-btn{background:transparent;border:none;color:#bbb;font-size:1.05rem;cursor:pointer;border-radius:6px;padding:4px 6px}
    .icon-btn:hover{background:#2a3344;color:#fff}
    .msg-edited{color:#888;font-size:.92em;margin-left:6px;font-style:italic}
    .msg-deleted{color:#999;font-style:italic}

    .chat-input-row{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line)}
    #chatInput{flex:1;padding:12px;border-radius:8px;border:1px solid #555;background:#333;color:#eee}
    #chatSend{padding:10px 16px}

    /* –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ */
    .userpick-list{max-height:420px;overflow:auto;border-top:1px solid #333;margin-top:10px;padding-top:8px}
    .userpick-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;cursor:pointer}
    .userpick-item:hover{background:#23272e}
    .userpick-avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;background:#1e1e1e;border:1px solid #333}
    .toast{position:fixed;left:50%;transform:translateX(-50%);top:22px;z-index:4000;background:#23272e;color:#fff;padding:12px 18px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s, top .25s}
    .toast.show{opacity:1;top:40px}

    /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ */
    #closeChatBtn{position:absolute;right:12px;top:8px}
  </style>
</head>
<body>
<header>
  <div class="logo">young1337</div>
  <nav class="header-nav">
  <!-- Liquid Glass Auth Modal Styles -->
  <style>
    .container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border-radius: 20px;
      padding: 40px;
      width: 500px;
      height: 350px;
      box-sizing: border-box;
      box-shadow: 0 0 25px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.15);
      color: white;
      position:relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .tabs {
      display: flex;
      position: relative;
      margin-bottom: 30px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      overflow: hidden;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 15px 0;
      cursor: pointer;
      font-size: 1.2em;
      color: rgba(255,255,255,0.7);
      transition: color 0.3s ease;
      position: relative;
      z-index: 1;
    }
    .tab.active { color: #fff; }
    .indicator {
      position: absolute;
      height: 100%;
      width: 50%;
      top: 0;
      left: 0;
      background: rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 12px;
      box-shadow: inset 0 0 25px rgba(255,255,255,0.3), inset 0 0 10px rgba(255,255,255,0.5);
      transition: left 0.4s ease;
    }
    .form {
      display: none;
      flex-direction: column;
      gap: 20px;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
    }
    .form.active {
      display: flex;
      opacity: 1;
      transform: translateY(0);
    }
    #authModal input {
      padding: 15px;
      font-size: 1.1em;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(5px);
      color: white;
      outline: none;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.2);
    }
    #authModal input::placeholder { color: rgba(255,255,255,0.6); }
    #authModal button {
      padding: 15px;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: white;
      font-weight: bold;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 15px rgba(255,255,255,0.25), 0 4px 20px rgba(0,0,0,0.4);
      transition: transform 0.2s ease, box-shadow 0.3s ease;
    }
    #authModal button::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.5) 0%, transparent 70%);
      opacity: 0.2;
      transform: translate(-50%, -50%) rotate(0deg);
      transition: transform 0.5s ease;
    }
    #authModal button:hover::before { transform: translate(-50%, -50%) rotate(25deg); }
    #authModal button:hover {
      transform: scale(1.03);
      box-shadow: inset 0 0 20px rgba(255,255,255,0.35), 0 6px 25px rgba(0,0,0,0.5);
    }
  </style>
  <button class="app-button" id="openProfile" style="display:none;">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button class="app-button" id="openAuth">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button>
  <button class="app-button" id="openChat">–ß–∞—Ç—ã</button>
  <button class="app-button" id="openPosts">–ü–æ—Å—Ç—ã</button>
  <button class="app-button" id="openNews">–ù–æ–≤–æ—Å—Ç–∏</button>
  </nav>
</header>

<main id="mainContent">
  <h1>–ü—Ä–∏–≤–µ—Ç!</h1>
</main>

<!-- AUTH MODAL (Liquid Glass) -->
<div id="authModal" class="modal" style="z-index:3000;">
  <div class="container">
    <div class="tabs">
      <div class="indicator"></div>
      <div class="tab active" data-tab="login">–í—Ö–æ–¥</div>
      <div class="tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
    </div>
    <form class="form active" id="login">
      <input type="email" id="loginEmail" placeholder="Email" required>
      <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
      <button type="submit" id="loginSubmit">–í–æ–π—Ç–∏</button>
    </form>
    <form class="form" id="register">
      <input type="email" id="registerEmail" placeholder="Email" required>
      <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å" required>
      <button type="submit" id="registerSubmit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>
  <button class="close-btn" id="closeAuth" style="position:absolute;right:18px;top:18px;font-size:1.1rem;background:none;border:none;cursor:pointer;">√ó</button>
  </div>
</div>
<!-- PROFILE -->
<div id="profileModal" class="modal">
  <div class="modal-content-gray" style="max-width:480px">
    <button class="close-btn" id="closeProfile">√ó</button>
    <img id="profileAvatar" class="profile-avatar" src="" alt="avatar">
    <div class="center-btn">
      <button id="changeAvatarBtn" class="app-button" style="margin-bottom:0;">–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
    </div>
    <div style="margin:8px 0">
      <span id="profileNickname" style="font-weight:800"></span>
      <button id="editNickBtn" class="edit-nick-btn" title="–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫">‚úèÔ∏è</button>
      <span id="profileRoleBadge" class="role-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
    </div>
<!-- POSTS MODAL -->
<div id="postsModal" class="modal" style="background:rgba(0,0,0,.45);align-items:flex-start;justify-content:center;">
  <div class="chat-window" style="max-width:1100px;width:95vw;height:80vh;margin-top:64px;">
    <button class="close-btn" id="closePosts" style="position:absolute;right:12px;top:8px;z-index:10;">√ó</button>
    <section class="chat-main" style="flex:1;display:flex;flex-direction:column;min-width:0;">
      <div class="chat-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h2 style="margin:0">–ü–æ—Å—Ç—ã</h2>
        <button id="addPostBtn" class="app-button" style="font-size:1.2em;padding:6px 18px;">+ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
      </div>
      <div id="postsList" style="flex:1;overflow-y:auto;padding:10px;background:transparent;"></div>
    </section>
  </div>
</div>

<!-- ADD POST MODAL -->
<div id="addPostModal" class="modal">
  <div class="modal-content-gray" style="max-width:420px">
    <button class="close-btn" id="closeAddPost">√ó</button>
    <h2>–ù–æ–≤—ã–π –ø–æ—Å—Ç</h2>
    <input id="postImageInput" type="file" accept="image/*" style="margin-bottom:10px">
    <textarea id="postTextInput" class="input-gray" placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞" style="height:80px"></textarea>
    <button id="publishPostBtn" class="modal-main-btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
  </div>
</div>

<!-- POST COMMENTS MODAL -->
<div id="commentsModal" class="modal">
  <div class="modal-content-gray" style="max-width:480px">
    <button class="close-btn" id="closeComments">√ó</button>
    <h2>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
    <div id="commentsList" style="max-height:320px;overflow-y:auto;margin-bottom:10px;"></div>
    <div style="display:flex;gap:8px;align-items:center;">
      <input id="commentInput" class="input-gray" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="flex:1">
      <button id="sendCommentBtn" class="app-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>
    <div style="margin:6px 0">–ü–æ—á—Ç–∞: <span id="profileEmail"></span></div>
    <div style="margin:6px 0">
      <input id="changeAvatarInput" type="file" accept="image/*" style="display:none" />
      <!-- –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è -->
      <div class="profile-pass-row">
        <input id="newPasswordInput" class="input-gray" type="password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
        <button id="changePasswordBtn" class="app-button">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
      </div>
    </div>
    <button id="logoutBtn" class="modal-main-btn" style="margin-top:10px;background:#e74c3c">–í—ã–π—Ç–∏</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ —Å–º–µ–Ω—ã –Ω–∏–∫–∞ -->
<div id="nickModal" class="modal">
  <div class="modal-content-gray" style="max-width:340px">
    <button class="close-btn" id="closeNickModal">√ó</button>
    <h2>–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</h2>
    <input id="nicknameInput" class="input-gray" placeholder="–ù–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º">
    <button id="saveNicknameBtn" class="modal-main-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<!-- CHAT PANEL -->
<div id="chatPanel" class="modal" style="background:rgba(0,0,0,.45)">
  <div class="chat-window">
    <button id="closeChatBtn" class="close-btn" title="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
    <aside class="chat-left">
      <div class="chat-left-header">–ß–∞—Ç—ã</div>
      <button id="addChatBtn" class="chat-add-btn">+</button>
      <div id="chatList" class="chat-list"></div>
    </aside>
    <section class="chat-main">
      <div class="chat-header">
  <img id="peerAvatar" class="chat-peer-avatar empty" src="" alt="">
  <div class="chat-peer-name" id="peerName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
      </div>
      <div id="chatMessages" class="chat-msgs"></div>
      <div class="chat-input-row">
        <input id="chatInput" type="text" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
        <button id="chatSend" class="app-button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </section>
  </div>
</div>

<!-- USER PICKER -->
<div id="userPickerModal" class="modal">
  <div class="modal-content-gray" style="max-width:520px">
    <button class="close-btn" id="closeUserPicker">√ó</button>
    <h2>–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç</h2>
    <input id="userSearch" class="input-gray" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É –∏–ª–∏ email">
    <div id="userPickerList" class="userpick-list"></div>
  </div>
</div>

<!-- NEWS -->
<div id="newsModal" class="modal">
  <div class="modal-content-gray">
    <button class="close-btn" id="closeNews">√ó</button>
    <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
    <div style="text-align:left">
      <ul>
        <li>2.0 Update -14-08-2025- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ!, –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —á–∞—Ç—ã, –Ω–æ–≤—ã–π –¥–∏–∑–∞–π–Ω
          –≤ —Å—Ç–∏–ª–µ Liquid Glass, –Ω–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å, #—Ç–µ–≥–∏
          –°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤ –ø–æ—Å–ª–µ —Ö–æ—Å—Ç–∏–Ω–≥–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è
          –ø–æ—Å–ª–µ —Å–∞–º–æ–≥–æ –ø–µ—Ä–≤–æ–≥–æ, –Ω–µ –ø—É–≥–∞–π—Ç–µ—Å—å, —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ, Firebase –¥–æ —Å–∏—Ö –ø–æ—Ä —à–∞–ª–∏—Ç.
        </li>
      </ul>
    </div>
  </div>
</div>

<script type="module">
import { getFirestore, collection, query as fsQuery, orderBy as fsOrderBy, onSnapshot, addDoc, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
/* ======================== Firebase ======================== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, push, onValue, off, remove, set, update, get, child, limitToLast, orderByChild } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDjTaleNo3RlfJECEEm24UGg4sx6AFvp7E",
  authDomain: "young1337-c6a15.firebaseapp.com",
  databaseURL: "https://young1337-c6a15-default-rtdb.firebaseio.com",
  projectId: "young1337-c6a15",
  storageBucket: "young1337-c6a15.appspot.com",
  messagingSenderId: "349710701737",
  appId: "1:349710701737:web:c9f5e5e86d0b29dc6b05b8",
  measurementId: "G-DXVL8D5L44"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const storage = getStorage(app);

// Firestore –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
const fsdb = getFirestore(app);

/* ======================== Utils ======================== */
const ADMIN_EMAIL = "timurnazaev001@gmail.com";
const ROLE_LABELS = { admin:"–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", user:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" };
const ROLE_CLASS = { admin:"chat-role-badge chat-role-admin", user:"chat-role-badge chat-role-user" };
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const toast = $('#toast');

function showToast(msg, type='info'){
  toast.textContent = msg;
  toast.style.background = type==='error' ? '#2e2323' : type==='success' ? '#23272e' : '#23272e';
  toast.style.color = type==='error' ? '#f66' : type==='success' ? '#3fcf7f' : '#fff';
  toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2200);
}
function escapeHtml(s){ return (s??'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;') }
function fmtTime(ts){ const d=new Date(ts); return d.toLocaleString('ru-RU',{hour:'2-digit',minute:'2-digit',day:'2-digit',month:'2-digit'}) }
function avatarOf(nick){ return "https://ui-avatars.com/api/?name="+encodeURIComponent(nick||'?')+"&background=323a47&color=3fa7ff" }
function chatIdOf(a,b){ return [a,b].sort().join('_') }
function preview(text, n=40){ if(!text) return ""; const t=text.replace(/\s+/g,' ').trim(); return t.length>n? t.slice(0,n-1)+'‚Ä¶':t }

/* ======================== DOM refs ======================== */
const openProfileBtn = $('#openProfile');
const openAuthBtn    = $('#openAuth');
const openChatBtn    = $('#openChat');
const openNewsBtn    = $('#openNews');

const authModal = $('#authModal');
const closeAuth = $('#closeAuth');
const profileModal = $('#profileModal'); const closeProfile = $('#closeProfile');
const newsModal = $('#newsModal'); const closeNews = $('#closeNews');

const userPickerModal = $('#userPickerModal'); const closeUserPicker = $('#closeUserPicker');
const userSearch = $('#userSearch'); const userPickerList = $('#userPickerList');

const chatPanel = $('#chatPanel'); const chatList = $('#chatList');
const addChatBtn = $('#addChatBtn'); const chatMessages = $('#chatMessages');
const chatInput = $('#chatInput'); const chatSend = $('#chatSend');
const peerName = $('#peerName'); const peerAvatar = $('#peerAvatar');

const profileEmail = $('#profileEmail'); const profileNickname = $('#profileNickname');
const profileRoleBadge = $('#profileRoleBadge'); const profileAvatar = $('#profileAvatar');
const editNickBtn = $('#editNickBtn');
const nickModal = $('#nickModal'); const closeNickModal = $('#closeNickModal');
const nicknameInput = $('#nicknameInput'); const saveNicknameBtn = $('#saveNicknameBtn');
const changeAvatarBtn = $('#changeAvatarBtn'); const changeAvatarInput = $('#changeAvatarInput');
const logoutBtn = $('#logoutBtn');
const newPasswordInput = $('#newPasswordInput'); const changePasswordBtn = $('#changePasswordBtn');
// Posts
const openPostsBtn = document.getElementById('openPosts');
const postsModal = document.getElementById('postsModal');
const closePosts = document.getElementById('closePosts');
const addPostBtn = document.getElementById('addPostBtn');
const postsList = document.getElementById('postsList');
const addPostModal = document.getElementById('addPostModal');
const closeAddPost = document.getElementById('closeAddPost');
const postImageInput = document.getElementById('postImageInput');
const postTextInput = document.getElementById('postTextInput');
const publishPostBtn = document.getElementById('publishPostBtn');
const commentsModal = document.getElementById('commentsModal');
const closeComments = document.getElementById('closeComments');
const commentsList = document.getElementById('commentsList');
const commentInput = document.getElementById('commentInput');
const sendCommentBtn = document.getElementById('sendCommentBtn');
/* ======================== State ======================== */
let curUser = null;
let curUserData = {nickname:"", avatar:"", role:"user", email:""};
let usersCache = {};     // uid -> {nickname, avatar, email, role}
let chatListenerRef = null; // ref –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è —á–∞—Ç–∞
let currentPeerUid = null;
let currentChatId = null;

/* ======================== UI helpers ======================== */
function showModal(el){ el.style.display='flex' }
function hideModal(el){ el.style.display='none' }

function setAuthUI(authenticated){
  if(authenticated){
    openProfileBtn.style.display=''; openAuthBtn.style.display='none';
  }else{
    openProfileBtn.style.display='none'; openAuthBtn.style.display='';
  }
}

/* ======================== Auth ======================== */

document.getElementById('register').addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('registerEmail').value.trim();
  const pass = document.getElementById('registerPassword').value.trim();
  if(!email || !pass) return showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
  try{
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    const nick = email.split('@')[0];
    const role = email===ADMIN_EMAIL ? 'admin' : 'user';
    await set(ref(db, 'users/'+cred.user.uid), { email, nickname:nick, avatar:'', role });
    showToast('–£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', 'success'); hideModal(authModal);
  }catch(e){ showToast('–û—à–∏–±–∫–∞: '+e.message, 'error') }
});

document.getElementById('login').addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPassword').value.trim();
  if(!email || !pass) return showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
  try{
    await signInWithEmailAndPassword(auth, email, pass);
    hideModal(authModal); showToast('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
  }catch(e){ showToast('–û—à–∏–±–∫–∞: '+e.message, 'error') }
});

logoutBtn.onclick = ()=> signOut(auth);

/* ======================== Users cache & picker ======================== */
async function refreshUsersCache(){
  const snap = await get(ref(db,'users'));
  usersCache = snap.exists()? snap.val() : {};
}

function openUserPicker(){
  userSearch.value = '';
  renderUserPicker('');
  showModal(userPickerModal);
}
function renderUserPicker(filter){
  const f = (filter||'').toLowerCase();
  userPickerList.innerHTML = '';
  Object.entries(usersCache).forEach(([uid,u])=>{
    if(!curUser || uid===curUser.uid) return;
    const needle = (u.nickname||'')+' '+(u.email||'');
    if(f && !needle.toLowerCase().includes(f)) return;
    const av = u.avatar || avatarOf(u.nickname);
    const el = document.createElement('div');
    el.className = 'userpick-item';
    el.innerHTML = `
      <img class="userpick-avatar" src="${av}" alt="">
      <div style="display:flex;flex-direction:column">
        <div style="font-weight:800;color:#fff">${escapeHtml(u.nickname||'?')}</div>
        <div style="color:#aaa;font-size:.92em">${escapeHtml(u.email||'')}</div>
      </div>
    `;
    el.onclick = ()=>{ hideModal(userPickerModal); openChatWith(uid); };
    userPickerList.appendChild(el);
  });
}
userSearch.addEventListener('input', e=>renderUserPicker(e.target.value));

// ======================== Firestore Chat ========================
function openChatWith(peerUid){
  if(!curUser) { showToast('–í–æ–π–¥–∏—Ç–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç—É', 'error'); return; }
  if(chatListenerRef){ chatListenerRef(); chatListenerRef = null; }
  currentPeerUid = peerUid;
  currentChatId = chatIdOf(curUser.uid, peerUid);

  const u = usersCache[peerUid] || {};
  const av = u.avatar || avatarOf(u.nickname);
  if (u.avatar) {
    peerAvatar.src = av;
    peerAvatar.classList.remove('empty');
  } else {
    peerAvatar.src = '';
    peerAvatar.classList.add('empty');
  }
  peerName.textContent = u.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';

  chatMessages.innerHTML = '<div style="color:#aaa;text-align:center;margin-top:16px">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';

  // Firestore: —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —á–∞—Ç –≤ userChats –¥–ª—è –æ–±–æ–∏—Ö, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
  const my = usersCache[curUser.uid] || curUserData || {};
  const peer = usersCache[peerUid] || {};
  const userChatsRef = doc(fsdb, "userChats", curUser.uid, "peers", peerUid);
  const peerChatsRef = doc(fsdb, "userChats", peerUid, "peers", curUser.uid);
  setDoc(userChatsRef, {
    lastTimestamp: Date.now(),
    lastMessage: '',
    peerNickname: peer.nickname || '',
    peerAvatar: peer.avatar || '',
    peerRole: peer.role || 'user',
    created: true
  }, { merge: true });
  setDoc(peerChatsRef, {
    lastTimestamp: Date.now(),
    lastMessage: '',
    peerNickname: my.nickname || '',
    peerAvatar: my.avatar || '',
    peerRole: my.role || 'user',
    created: true
  }, { merge: true });

  chatListenerRef = listenToMessages(currentChatId);
  $$('.chat-item').forEach(x=>x.classList.toggle('selected', x.dataset.uid===peerUid));
  renderChatHeader(u);
  // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ—á–∏—Å—Ç–∫–∏ —á–∞—Ç–∞
  const clearBtn = document.getElementById('clearChatBtn');
  clearBtn.onclick = async () => {
    if (!currentChatId) return;
    if (!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —ç—Ç–æ–º —á–∞—Ç–µ?')) return;
    // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Firestore
    const msgsRef = collection(fsdb, "chats", currentChatId, "messages");
    const snap = await getDocs(msgsRef);
    const batch = window.firebaseBatch ? window.firebaseBatch(fsdb) : null;
    if (batch) {
      snap.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
    } else {
      // –ë–µ–∑ batch (–µ—Å–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω): —É–¥–∞–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–º—É
      for (const docu of snap.docs) {
        await deleteDoc(docu.ref);
      }
    }
    showToast('–ß–∞—Ç –æ—á–∏—â–µ–Ω', 'success');
  };
}

function listenToMessages(chatId) {
  const messagesRef = collection(fsdb, "chats", chatId, "messages");
  const q = fsQuery(messagesRef, fsOrderBy("timestamp", "asc"));
  return onSnapshot(q, (snapshot) => {
    const messages = snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }));
    renderMessages(messages);
  });
}

function renderMessages(messages) {
  chatMessages.innerHTML = '';
  if(messages.length === 0) {
    chatMessages.innerHTML = '<div style="color:#666;text-align:center;margin-top:16px">–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. –ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
    return;
  }
  messages.forEach(m => renderMessage(m));
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Firestore)
function listenChatList() {
  if (!curUser) return;
  const userChatsRef = collection(fsdb, "userChats", curUser.uid, "peers");
  const q = fsQuery(userChatsRef, fsOrderBy("lastTimestamp", "desc"));
  onSnapshot(q, snap => {
    const arr = snap.docs.map(doc => ({ peerUid: doc.id, ...doc.data() }));
    renderChatList(arr);
  });
}

function renderChatList(items) {
  chatList.innerHTML = '';
  items.forEach(item => {
    const u = usersCache[item.peerUid] || {};
    const avatar = (item.peerAvatar || u.avatar || avatarOf(u.nickname));
    const selected = item.peerUid === currentPeerUid ? 'selected' : '';
    const li = document.createElement('div');
    li.className = `chat-item ${selected}`;
    li.dataset.uid = item.peerUid;
    li.innerHTML = `
      <img class="chat-item-avatar" src="${avatar}" alt="">
      <div class="chat-item-txt">
        <div class="chat-item-nick">${escapeHtml(u.nickname || '???')}</div>
        <div class="chat-item-last">${escapeHtml(item.lastMessage || '')}</div>
      </div>
      <button class="chat-delete-btn" title="–£–¥–∞–ª–∏—Ç—å —á–∞—Ç" style="background:none;border:none;cursor:pointer;color:#888;font-size:1.1em;float:right;margin-left:auto;">üóëÔ∏è</button>
    `;
    // –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–±–ª–∞—Å—Ç—å, –∫—Ä–æ–º–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
    li.addEventListener('click', e => {
      if (e.target.classList.contains('chat-delete-btn')) return;
      openChatWith(item.peerUid);
    });
    // –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É
    li.querySelector('.chat-delete-btn').onclick = async (e) => {
      e.stopPropagation();
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç –∏ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è?')) return;
      // –£–¥–∞–ª–∏—Ç—å —á–∞—Ç —Ç–æ–ª—å–∫–æ —É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const chatRef = doc(fsdb, "userChats", curUser.uid, "peers", item.peerUid);
      await setDoc(chatRef, {}, { merge: false });
      // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const chatId = chatIdOf(curUser.uid, item.peerUid);
      const msgsRef = collection(fsdb, "chats", chatId, "messages");
      const snap = await getDocs(msgsRef);
      for (const docu of snap.docs) {
        await deleteDoc(docu.ref);
      }
      showToast('–ß–∞—Ç –∏ —Å–æ–æ–±—â–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã', 'success');
    };
    chatList.appendChild(li);
  });
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Firestore
async function sendMessage() {
  const text = chatInput.value.trim();
  if(!text || !curUser || !currentPeerUid) return;

  const my = usersCache[curUser.uid] || curUserData || {};
  const timestamp = Date.now();
  chatInput.value = '';
  chatInput.focus();

  // Firestore: –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  const messagesRef = collection(fsdb, "chats", currentChatId, "messages");
  await addDoc(messagesRef, {
    uid: curUser.uid,
    email: curUser.email,
    nickname: my.nickname || (curUser.email||'').split('@')[0],
    avatar: my.avatar || '',
    role: my.role || 'user',
    message: text,
    timestamp
  });

  // Firestore: —Å–æ–∑–¥–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã —á–∞—Ç–∞ –¥–ª—è –æ–±–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const peer = usersCache[currentPeerUid] || {};
  const prev = preview(text);
  const userChatsRef = doc(fsdb, "userChats", curUser.uid, "peers", currentPeerUid);
  const peerChatsRef = doc(fsdb, "userChats", currentPeerUid, "peers", curUser.uid);
  // –ï—Å–ª–∏ —á–∞—Ç–∞ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å
  await Promise.all([
    setDoc(userChatsRef, {
      lastTimestamp: timestamp, lastMessage: prev,
      peerNickname: peer.nickname || '', peerAvatar: peer.avatar || '', peerRole: peer.role || 'user',
      created: true
    }, { merge: true }),
    setDoc(peerChatsRef, {
      lastTimestamp: timestamp, lastMessage: prev,
      peerNickname: my.nickname || '', peerAvatar: my.avatar || '', peerRole: my.role || 'user',
      created: true
    }, { merge: true })
  ]);
}

// –î–ª—è Firestore

/* ======================== Open chat & messages ======================== */
function openChatPanel(){
  showModal(chatPanel);
  setTimeout(()=>chatInput.focus(), 50);
}
function closeChatPanel(){
  hideModal(chatPanel);
}

function getRoleBadge(role){
  const cls = ROLE_CLASS[role] || ROLE_CLASS.user;
  const title = ROLE_LABELS[role] || ROLE_LABELS.user;
  return `<span class="${cls}">${title}</span>`;
}

function renderMessage(m){
  const mine = curUser && m.uid===curUser.uid;
  const container = document.createElement('div');
  container.className = 'msg-row';
  const u = usersCache[m.uid] || {};
  const hashtag = u.hashtag ? `<span style="color:#3fa7ff;font-weight:700;margin-right:4px">${escapeHtml(u.hashtag)}</span>` : '';
  const nickname = m.nickname || u.nickname || '???';
  const avatar = m.avatar || u.avatar || avatarOf(nickname);
  const role = m.role || u.role || 'user';
  const editedMark = m.edited ? `<span class="msg-edited">(–∏–∑–º–µ–Ω–µ–Ω–æ)</span>` : '';
  const textHtml = `<span class="msg-text">${escapeHtml(m.message||'')}</span>`;
  let editBtn = '';
  if(mine) editBtn = `<button class="icon-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ" data-key="${m.key}">‚úèÔ∏è</button>`;
  container.innerHTML = `
    <img class="msg-avatar" src="${avatar}" alt="">
    <div style="flex:1;min-width:0">
      <div class="msg-head">
        ${hashtag}<span class="msg-nick">${escapeHtml(nickname)}</span>
        ${getRoleBadge(role)}
        <span class="msg-time">${fmtTime(m.timestamp||Date.now())}</span>
        ${editedMark}
        ${editBtn}
      </div>
      <div class="msg-body" data-key="${m.key}">
        ${textHtml}
      </div>
    </div>
  `;
  chatMessages.appendChild(container);
  // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  if(mine) {
    container.querySelector('.icon-btn').onclick = () => startEditMessage(m);
  }
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// –ú–æ–¥–∞–ª–∫–∞/–∏–Ω–ø—É—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
let editMsgModal = null;
function startEditMessage(m) {
  if(editMsgModal) editMsgModal.remove();
  editMsgModal = document.createElement('div');
  editMsgModal.style.position = 'fixed';
  editMsgModal.style.left = '0';
  editMsgModal.style.top = '0';
  editMsgModal.style.width = '100vw';
  editMsgModal.style.height = '100vh';
  editMsgModal.style.background = 'rgba(0,0,0,0.5)';
  editMsgModal.style.display = 'flex';
  editMsgModal.style.alignItems = 'center';
  editMsgModal.style.justifyContent = 'center';
  editMsgModal.style.zIndex = '5000';
  editMsgModal.innerHTML = `<div style='background:#23272e;padding:32px 28px;border-radius:14px;min-width:320px;max-width:90vw;'>
    <h3 style='margin-top:0'>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
    <textarea id='editMsgInput' style='width:100%;height:80px;border-radius:8px;padding:10px;font-size:1.1em;'>${escapeHtml(m.message||'')}</textarea>
    <div style='margin-top:18px;text-align:right;'>
      <button id='editMsgSave' style='padding:10px 22px;border-radius:8px;background:#3fa7ff;color:#fff;font-weight:700;border:none;cursor:pointer;'>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id='editMsgCancel' style='padding:10px 22px;border-radius:8px;background:#555;color:#fff;font-weight:700;border:none;cursor:pointer;margin-left:10px;'>–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>`;
  document.body.appendChild(editMsgModal);
  document.getElementById('editMsgInput').focus();
  document.getElementById('editMsgSave').onclick = async () => {
    const newText = document.getElementById('editMsgInput').value.trim();
    if(!newText) return showToast('–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º','error');
    await update(ref(db, `privateChats/${currentChatId}/${m.key}`), { message: newText, edited: true });
    editMsgModal.remove();
  };
  document.getElementById('editMsgCancel').onclick = () => editMsgModal.remove();
  editMsgModal.onclick = e => { if(e.target === editMsgModal) editMsgModal.remove(); };
}

// –ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è —à–∞–ø–∫–∞ —á–∞—Ç–∞
function renderChatHeader(peer) {
  const chatHeader = document.querySelector('.chat-header');
  if (!chatHeader) return;
  chatHeader.innerHTML = `
    <img id="peerAvatar" class="chat-peer-avatar${peer.avatar ? '' : ' empty'}" src="${peer.avatar || ''}" alt="">
    <div class="chat-peer-name" id="peerName">${escapeHtml(peer.nickname || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å')}</div>
  `;
}

/* ======================== Profile ======================== */
// –°–º–µ–Ω–∞ –Ω–∏–∫–∞ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É
editNickBtn.onclick = ()=>{ nicknameInput.value = profileNickname.textContent; showModal(nickModal); };
closeNickModal.onclick = ()=> hideModal(nickModal);
saveNicknameBtn.onclick = async ()=>{
  if(!curUser) return;
  const nn = nicknameInput.value.trim(); if(!nn) return showToast('–ù–∏–∫ –ø—É—Å—Ç','error');
  await update(ref(db, 'users/'+curUser.uid), { nickname: nn });
  profileNickname.textContent = nn;
  await refreshUsersCache();
  showToast('–ù–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω','success');
  hideModal(nickModal);
};
// –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å)
changePasswordBtn.onclick = async ()=>{
  if(!curUser) return;
  const newPass = newPasswordInput.value.trim();
  if(!newPass) return showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å','error');
  try{
    const { updatePassword } = await import("https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js");
    await updatePassword(auth.currentUser, newPass);
    showToast('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω','success');
    newPasswordInput.value = '';
  }catch(e){ showToast('–û—à–∏–±–∫–∞: '+e.message,'error'); }
};
// –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
changeAvatarBtn.onclick = ()=> changeAvatarInput.click();
changeAvatarInput.onchange = async (e)=>{
  if(!curUser) return;
  const file = e.target.files[0]; if(!file) return;
  const fileRef = sRef(storage, `avatars/${curUser.uid}.jpg`);
  await uploadBytes(fileRef, file);
  const url = await getDownloadURL(fileRef);
  await update(ref(db, 'users/'+curUser.uid), { avatar:url });
  profileAvatar.src = url;
  await refreshUsersCache();
  showToast('–ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω','success');
};

/* ======================== POSTS ======================== */
// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –ø–æ—Å—Ç–æ–≤
async function openPostsModal() {
  // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –¥—Ä—É–≥–∏–µ –º–æ–¥–∞–ª–∫–∏ (–±–µ–∑ undefined)
  [authModal, profileModal, newsModal, chatPanel, userPickerModal, nickModal, addPostModal, commentsModal].filter(Boolean).forEach(hideModal);
  await refreshUsersCache();
  setTimeout(()=>{ showModal(postsModal); }, 50);
  loadPosts();
}
openPostsBtn.onclick = (e) => { e?.stopPropagation?.(); openPostsModal(); };

// –û—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', () => {
  openPostsModal();
  // –°–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É —á–∞—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–π
  openChatBtn.classList.remove('app-button-disabled');
  openChatBtn.removeAttribute('disabled');
  openChatBtn.style.pointerEvents = '';
  openChatBtn.style.opacity = '';
});
closePosts.onclick = (e) => { e?.stopPropagation?.(); hideModal(postsModal); };

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞
addPostBtn.onclick = (e) => {
  e?.stopPropagation?.();
  postImageInput.value = '';
  postTextInput.value = '';
  showModal(addPostModal);
};
closeAddPost.onclick = (e) => { e?.stopPropagation?.(); hideModal(addPostModal); };

// –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞
publishPostBtn.onclick = async (e) => {
  e?.stopPropagation?.();
  if (!curUser) return showToast('–í–æ–π–¥–∏—Ç–µ', 'error');
  const text = postTextInput.value.trim();
  if (!text) return showToast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç', 'error');
  let imageUrl = '';
  const file = postImageInput.files[0];
  if (file) {
    const fileRef = sRef(storage, `posts/${curUser.uid}_${Date.now()}.jpg`);
    await uploadBytes(fileRef, file);
    imageUrl = await getDownloadURL(fileRef);
  }
  const postRef = push(ref(db, 'posts'));
  await set(postRef, {
    uid: curUser.uid,
    nickname: curUserData.nickname || curUser.email.split('@')[0],
    avatar: curUserData.avatar || '',
    role: curUserData.role || 'user',
    text,
    image: imageUrl,
    timestamp: Date.now(),
    views: {},
    likes: {},
    comments: {}
  });
  // –ó–∞–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –º–æ–¥–∞–ª–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞, –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—ã
  hideModal(addPostModal);
  openPostsModal();
  showToast('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω', 'success');
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–Ω–¥–µ—Ä –ø–æ—Å—Ç–æ–≤
async function loadPosts() {
  postsList.innerHTML = '<div style="color:#aaa;text-align:center;margin-top:16px">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';
  const snap = await get(ref(db, 'posts'));
  if (!snap.exists()) {
    postsList.innerHTML = '<div style="color:#666;text-align:center;margin-top:16px">–ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
    return;
  }
  const arr = Object.entries(snap.val()).map(([key, val]) => ({ key, ...val }));
  arr.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
  postsList.innerHTML = '';
  arr.forEach(post => renderPost(post));
}

function renderPost(post) {
  const mine = curUser && post.uid === curUser.uid;
  const avatar = post.avatar || avatarOf(post.nickname);
  const role = post.role || 'user';
  const roleBadge = role === 'admin' ? `<span class="chat-role-badge chat-role-admin">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</span>` : '';
  const likes = post.likes ? Object.keys(post.likes).length : 0;
  const views = post.views ? Object.keys(post.views).length : 0;
  const liked = curUser && post.likes && post.likes[curUser.uid];
  const postDiv = document.createElement('div');
  postDiv.className = 'post-item';
  postDiv.style = 'background:#23272e;border-radius:10px;padding:14px 14px 10px 14px;margin-bottom:16px;box-shadow:0 2px 8px #0001;position:relative;max-width:600px;margin-left:auto;margin-right:auto;';
  postDiv.innerHTML = `
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
      <img src="${avatar}" alt="avatar" style="width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid #3fa7ff;">
      <div style="font-weight:800;color:#fff;">${escapeHtml(post.nickname || '?')}</div>
      ${roleBadge}
      <div style="color:#aaa;font-size:.93em;margin-left:auto;">${fmtTime(post.timestamp)}</div>
      ${mine ? `<button class="delete-post-btn" title="–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç" style="background:none;border:none;color:#e74c3c;font-size:1.3em;cursor:pointer;margin-left:10px;">üóë</button>` : ''}
    </div>
    ${post.image ? `<img src="${post.image}" alt="post" style="max-width:100%;border-radius:8px;margin-bottom:8px;">` : ''}
    <div style="color:#fff;font-size:1.08em;margin-bottom:8px;text-align:left;">${escapeHtml(post.text)}</div>
    <div style="display:flex;align-items:center;gap:16px;margin-bottom:6px;">
      <span style="color:#aaa;font-size:.97em;">üëÅ ${views}</span>
      <button class="like-btn" data-key="${post.key}" style="background:none;border:none;color:${liked ? '#3fa7ff' : '#aaa'};font-size:1.08em;cursor:pointer;">‚ù§ ${likes}</button>
    </div>
    <div class="vk-comments" id="vk-comments-${post.key}" style="background:#23272e;padding:0 0 0 0;margin:0 0 0 0;"></div>
  `;
  // –õ–∞–π–∫
  postDiv.querySelector('.like-btn').onclick = () => toggleLike(post.key, liked);
  // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
  if(mine) {
    postDiv.querySelector('.delete-post-btn').onclick = async () => {
      if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) {
        await remove(ref(db, `posts/${post.key}`));
        loadPosts();
      }
    };
  }
  // –ü—Ä–æ—Å–º–æ—Ç—Ä
  if (curUser && (!post.views || !post.views[curUser.uid])) {
    update(ref(db, `posts/${post.key}/views`), { [curUser.uid]: true });
  }
  // –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä—è–º–æ –ø–æ–¥ –ø–æ—Å—Ç–æ–º
  renderInlineComments(post.key, postDiv.querySelector('.vk-comments'));
  postsList.appendChild(postDiv);
}

// –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–¥ –ø–æ—Å—Ç–æ–º (–¥–æ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö + —Ñ–æ—Ä–º–∞)
async function renderInlineComments(postKey, container) {
  container.innerHTML = '<div style="color:#aaa;text-align:center;margin:8px 0 4px 0;font-size:.98em;">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤‚Ä¶</div>';
  const snap = await get(ref(db, `posts/${postKey}/comments`));
  let arr = [];
  if (snap.exists()) {
    arr = Object.entries(snap.val()).map(([key, val]) => ({ key, ...val }));
    arr.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
  }
  container.innerHTML = '';
  if(arr.length === 0) {
    container.innerHTML = '<div style="color:#666;text-align:left;margin:4px 0 8px 0;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
  } else {
    arr.slice(-3).forEach(c => {
      const avatar = c.avatar || avatarOf(c.nickname);
      const role = c.role || 'user';
      const roleBadge = role === 'admin' ? `<span class=\"chat-role-badge chat-role-admin\">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</span>` : '';
      const div = document.createElement('div');
      div.style = 'display:flex;align-items:center;gap:8px;margin-bottom:6px;';
      div.innerHTML = `
        <img src="${avatar}" alt="avatar" style="width:32px;height:32px;border-radius:50%;object-fit:cover;border:1px solid #3fa7ff;">
        <div style="display:flex;align-items:center;gap:7px;flex-wrap:wrap;flex:1;min-width:0;">
          <span style="font-weight:800;color:#fff;">${escapeHtml(c.nickname || '?')}</span>
          ${roleBadge}
          <span style="color:#aaa;font-size:.93em;">${fmtTime(c.timestamp)}</span>
          <span style="color:#fff;margin-left:10px;word-break:break-word;">${escapeHtml(c.text)}</span>
        </div>
      `;
      container.appendChild(div);
    });
  }
  // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  if(curUser) {
    const formDiv = document.createElement('div');
    formDiv.style = 'display:flex;gap:6px;align-items:center;margin-top:2px;';
    formDiv.innerHTML = `
      <input class="input-gray" id="inlineCommentInput-${postKey}" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." style="flex:1;font-size:.98em;padding:7px 10px;">
      <button class="app-button" id="inlineSendCommentBtn-${postKey}" style="padding:7px 14px;font-size:.98em;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    `;
    container.appendChild(formDiv);
    formDiv.querySelector(`#inlineSendCommentBtn-${postKey}`).onclick = async () => {
      const text = formDiv.querySelector(`#inlineCommentInput-${postKey}`).value.trim();
      if(!text) return showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π', 'error');
      const my = usersCache[curUser.uid] || curUserData || {};
      const commentRef = push(ref(db, `posts/${postKey}/comments`));
      await set(commentRef, {
        uid: curUser.uid,
        nickname: my.nickname || (curUser.email||'').split('@')[0],
        avatar: my.avatar || '',
        role: my.role || 'user',
        text,
        timestamp: Date.now()
      });
      renderInlineComments(postKey, container);
    };
  }
}

// –õ–∞–π–∫/–¥–∏–∑–ª–∞–π–∫
async function toggleLike(postKey, liked) {
  if (!curUser) return showToast('–í–æ–π–¥–∏—Ç–µ', 'error');
  const likeRef = ref(db, `posts/${postKey}/likes/${curUser.uid}`);
  if (liked) {
    await remove(likeRef);
  } else {
    await set(likeRef, true);
  }
  loadPosts();
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
async function openComments(postKey) {
  commentsModal.dataset.postKey = postKey;
  commentInput.value = '';
  showModal(commentsModal);
  loadComments(postKey);
}
closeComments.onclick = () => hideModal(commentsModal);

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
async function loadComments(postKey) {
  commentsList.innerHTML = '<div style="color:#aaa;text-align:center;margin-top:10px">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';
  const snap = await get(ref(db, `posts/${postKey}/comments`));
  if (!snap.exists()) {
    commentsList.innerHTML = '<div style="color:#666;text-align:center;margin-top:10px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
    return;
  }
  const arr = Object.entries(snap.val()).map(([key, val]) => ({ key, ...val }));
  arr.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
  commentsList.innerHTML = '';
  arr.forEach(c => renderComment(c));
}

function renderComment(c) {
  const avatar = c.avatar || avatarOf(c.nickname);
  const role = c.role || 'user';
  const roleBadge = role === 'admin' ? `<span class="chat-role-badge chat-role-admin">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</span>` : '';
  const div = document.createElement('div');
  div.style = 'display:flex;align-items:flex-start;gap:10px;margin-bottom:10px;';
  div.innerHTML = `
    <img src="${avatar}" alt="avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;border:1px solid #3fa7ff;">
    <div style="flex:1;min-width:0">
      <div style="font-weight:800;color:#fff;display:flex;align-items:center;gap:8px;">${escapeHtml(c.nickname || '?')} ${roleBadge}</div>
      <div style="color:#aaa;font-size:.95em;">${fmtTime(c.timestamp)}</div>
      <div style="color:#fff;margin-top:2px;">${escapeHtml(c.text)}</div>
    </div>
  `;
  commentsList.appendChild(div);
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
sendCommentBtn.onclick = async () => {
  const postKey = commentsModal.dataset.postKey;
  if (!curUser || !postKey) return;
  const text = commentInput.value.trim();
  if (!text) return showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π', 'error');
  const my = usersCache[curUser.uid] || curUserData || {};
  const commentRef = push(ref(db, `posts/${postKey}/comments`));
  await set(commentRef, {
    uid: curUser.uid,
    nickname: my.nickname || (curUser.email||'').split('@')[0],
    avatar: my.avatar || '',
    role: my.role || 'user',
    text,
    timestamp: Date.now()
  });
  commentInput.value = '';
  loadComments(postKey);
};
/* ======================== Events ======================== */
openAuthBtn.onclick = ()=>{ showModal(authModal); };
closeAuth.onclick = ()=> hideModal(authModal);
openProfileBtn.onclick = ()=>{ if(curUser){ showModal(profileModal); } else showToast('–í–æ–π–¥–∏—Ç–µ', 'error'); };
closeProfile.onclick = ()=> hideModal(profileModal);
openNewsBtn.onclick = ()=> showModal(newsModal);
closeNews.onclick = ()=> hideModal(newsModal);


// –ö–Ω–æ–ø–∫–∞ —á–∞—Ç—ã –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
openChatBtn.onclick = ()=>{ openChatPanel(); };
$('#closeChatBtn').onclick = ()=> closeChatPanel();
addChatBtn.onclick = async ()=>{ await refreshUsersCache(); openUserPicker(); };
closeUserPicker.onclick = ()=> hideModal(userPickerModal);

// --- –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–ê–Ø sendMessage ---

chatSend.onclick = sendMessage;
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }});

/* ======================== Auth state ======================== */
onAuthStateChanged(auth, async (user)=>{
  curUser = user;
  setAuthUI(!!user);
  if(user){
    // load/ensure user record
    const us = await get(ref(db,'users/'+user.uid));
    if(us.exists()){
      curUserData = us.val();
    }else{
      const role = user.email===ADMIN_EMAIL ? 'admin' : 'user';
      await set(ref(db,'users/'+user.uid), { email:user.email, nickname:user.email.split('@')[0], avatar:'', role });
      curUserData = { email:user.email, nickname:user.email.split('@')[0], avatar:'', role };
    }
  await refreshUsersCache();
  // profile UI
  profileEmail.textContent = user.email;
  profileNickname.textContent = curUserData.nickname || user.email.split('@')[0];
  profileRoleBadge.textContent = ROLE_LABELS[curUserData.role] || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  profileAvatar.src = curUserData.avatar || avatarOf(curUserData.nickname);
  // nicknameInput –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω —Ç—É—Ç
  // nicknameInput.value = curUserData.nickname || '';

  // –í—Å–µ–≥–¥–∞ —Å–ª—É—à–∞—Ç—å —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞, –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è usersCache
  setTimeout(listenChatList, 100);

  }else{
    // reset
    chatList.innerHTML = '';
    chatMessages.innerHTML = '';
    peerName.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç';
    peerAvatar.src = '';
    currentPeerUid = null; currentChatId = null;
    hideModal(chatPanel);
  }
});


/* ======================== Click outside to close some modals ======================== */
window.addEventListener('click', (e)=>{
  if(e.target===authModal) hideModal(authModal);
// –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ –≤ –º–æ–¥–∞–ª–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
const tabs = document.querySelectorAll('.tab');
const forms = document.querySelectorAll('.form');
const indicator = document.querySelector('.indicator');
tabs.forEach((tab, index) => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    forms.forEach(f => f.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(tab.dataset.tab).classList.add('active');
    indicator.style.left = `${index * 50}%`;
  });
});
  if(e.target===newsModal) hideModal(newsModal);
  if(e.target===userPickerModal) hideModal(userPickerModal);
  if(e.target===chatPanel) hideModal(chatPanel);
});
// –ö–Ω–æ–ø–∫–∞ –∏ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞


</script>
</body>
</html>
